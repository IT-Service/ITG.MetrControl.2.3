{"name":"Itg.metrcontrol.2.3","tagline":".msi пакет для распространения в рамках домена продукта АИС Метроконтроль версии 2.3","body":"Метроконтроль 2.3 - .msi пакет\r\n==============================\r\n\r\nДанный проект - .msi пакет для развёртывания в рамках домена продукта АИС Метроконтроль версии 2.3. \r\n\r\nИнструменты для сборки .msi пакета\r\n----------------------------------\r\n\r\nДля внесения изменений в пакет и повторной сборки пакета потребуются следующие продукты:\r\n\r\n- Microsoft Visual Studio 2012 Shell:\r\n  - [Isolated](http://www.microsoft.com/ru-ru/download/details.aspx?id=30670)\r\n  - [Integrated](http://www.microsoft.com/ru-ru/download/details.aspx?id=30663)\r\n- [Windows Installer XML Toolset - WIX](http://wixtoolset.org/)\r\n\r\nУстановить необходимо все пакеты в указанном порядке. В результате - получае MS Visual Studio 2012 с подготовленными\r\nшаблонами проектов WiX. После этого открываем файл решения `Metrocontrol\\Metrocontrol.sln` и собираем решение.\r\n\r\nВарианты пакетов\r\n----------------\r\n\r\n### Административная точка установки\r\n\r\nВ папке `Metrocontrol\\bin\\Admin image\\x86\\ru-RU` собран проект, подготовленный к роли административной точки установки.\r\nВ нём отсутствует интерфейс пользователя.\r\n\r\n### .msi пакет в виде единого файла\r\n\r\nВ папке `Metrocontrol\\bin\\Single .msi file\\x86\\ru-RU` собран .msi пакет в виде единого файла.\r\nВ отличии от предыдущего варианта, в данной редакции присутствует интерфейс пользователя,\r\nпозволяющий изменить и состав продукта, и папку его установки.\r\n\r\nПодготовка административной точки установки\r\n-------------------------------------------\r\n\r\nПри подготовке административной точки установки доступны к изменении нижеописанные свойства.\r\n\r\n### ALLUSERS\r\n\r\nПо умолчанию - `\"1\"`. При установке `\"0\"` регистрация будет осуществлена в реестре пользователя, а не в реестре компьютера.\r\n\r\n### DISABLESHORTCUTS\r\n\r\nПо умолчанию - `\"No\"`. При установке значения `\"Yes\"` при установке не будут опубликованы ярлыки.\r\nДанным свойством следует воспользоваться, если Вы планируете запускать приложения АИС Метроконтроль через ярлыки на\r\n`.csmdb23` файлы (о данных дополнительных возможностях пакета читайте далее).\r\n\r\n### DISABLEDESKTOPSHORTCUTS\r\n\r\nПо умолчанию - `\"No\"`. При установке значения `\"Yes\"` при установке не будут опубликованы ярлыки на рабочем столе.\r\nПри `DISABLESHORTCUTS=\"Yes\"` значение данного свойства роли не играет.\r\n\r\n### DISABLEMENUSHORTCUTS\r\n\r\nПо умолчанию - `\"No\"`. При установке значения `\"Yes\"` при установке не будут опубликованы ярлыки в меню.\r\nПри `DISABLESHORTCUTS=\"Yes\"` значение данного свойства роли не играет.\r\n\r\n### DISABLESTARTUPSHORTCUTS\r\n\r\nПо умолчанию - `\"Yes\"`. При установке значения `\"Yes\"` при установке не будут опубликованы ярлык на АИС Метроконтроль\r\nв меню автозагрузки. При `DISABLESHORTCUTS=\"Yes\"` значение данного свойства роли не играет.\r\n\r\n### APPLICATIONFOLDER\r\n\r\nПуть к папке, в которую будет установлен программный продукт. По умолчанию - `%ProgramFiles(x86)%\\РЦН\\Метроконтроль\\2.3%`.\r\nУстанавливать в качестве значения данного свойства требуется только путь по отношению к `%ProgramFiles%`.\r\n\r\n### INSTALLLEVEL\r\n\r\nПо умолчанию - `\"100\"`. По умолчнию будут установлены только приложения \"АИС Метроконтроль\" и \"Учёт клейм\".\r\nПри установке `INSTALLLEVEL` больше 200 будет установлено и приложение \"Метроконтроль - администратор\".\r\n\r\n### Управление установкой приложений\r\n\r\nДля управления установкой приложений при подготовке административной точки установки следует воспользоваться\r\nсвойством `ADDDEFAULT`, перечислив приложения через запятую. Идентификаторы приложений:\r\n\r\n- `csmmain` - собственно \"АИС Метроконтроль\";\r\n- `markinv` - приложение \"Учёт клейм\";\r\n- `csmadmin` - приложение \"Метроконтроль - администратор\".\r\n\r\nНапример, если при подготовке административной точки установки указано `ADDDEFAULT=csmadmin`,\r\nто подготовленная точка установки без дополнительных трансформаций подзволит установить только\r\nприложение \"Метроконтроль - администратор\".\r\n\r\n### Примеры\r\n\r\nНесколько примеров подготовки административной точки установки:\r\n\r\n\tmsiexec -a Metrcontrol.msi DISABLEDESKTOPSHORTCUTS=Yes ALLUSERS=0 ADDDEFAULT=csmmain\r\n\r\nДанная командная строка готовит точку установки с \"отключенными\" ярлыками рабочего стола, с установкой приложения для пользователя\r\n(а не для компьютера). Из приложений при этом будет установлена только АИС Метроконтроль.\r\n\r\n\tmsiexec -a Metrcontrol.msi DISABLESHORTCUTS=Yes ADDDEFAULT=csmmain,makrinv,csmadmin\r\n\r\nДанная командная строка готовит точку установки с \"отключенными\" ярлыками. Приложения будут установлены все.\r\n\r\nИспользование нескольких БД\r\n---------------------------\r\n\r\nВ некоторых случаях необходима возможность подключаться к нескольким базам данных. При этом явно не стоит заставлять каждый раз\r\nвводить параметры подключения к БД. Для решения данной задачи в данном пакете регистрируется новый тип файла `.csmdb23` и\r\nProgId `RCN.Bootstrapper.2.3`.\r\n\r\n### Структура файла .csmdb23\r\n\r\nФайлы с расширением `.csmdb23` далее будем называть описателем базы данных АИС Метроконтроль. Файл, по сути, представляет собой\r\nini файл. За основу взят формат ini с одной только целью: предоставить возможность внесения изменений в данный файл посредством\r\nGPO+GPP.\r\n\r\nПример файла:\r\n\r\n\t[MetrControl]\r\n\tVersion=2.3\r\n\r\n\t[MetrControlDB]\r\n\tServer=<ip-адрес или FQDN SQL сервера>\r\n\tDatabase=<имя базы данных>\r\n\tDescription=<описание базы данных>\r\n\tNTLM=yes/no; использовать учётную запись пользователя для подключения к SQL серверу, или явно указанные учётные данные\r\n\tLogin=<login>\r\n\tPasswordHash=<password hash>\r\n\r\nСоздать файл-описатель Вашей БД можно через контекстное меню проводника \"Создать\"-\"Описатель БД АИС Метроконтроль\". Для изменения\r\nсозданного / существующего файла удерживайте Shift при щелчке правой кнопкой мыши на файле / ярлыке на `.csmdb23` файл, после чего\r\nвоспользуйтесь глаголом \"Изменить\" (он доступен только при нажатой клавише Shift).\r\n\r\nВместо пароля следует сохранять хеш пароля, который следует получить из файла `CnnSettings.xml`, создаваемого АИС Метроконтроль\r\nпри подключении к БД в профиле пользователя (`%LocalAppData%\\IFirst\\MetrControl\\CnnSettings.xml`).\r\n\r\n### Действия с .csmdb23\r\n\r\nПри двойном щелчке на файле `.csmdb23` или на ярлыке на файл данного типа активируется PowerShell сценарий, формирующий на основе\r\nданных из `.csmdb23` файл `CnnSettings.xml`, после чего активирует приложение \"АИС Метроконтроль\" (на данном этапе поддерживаются\r\nмеханизмы ms installer, и перед запуском приложения будут проверены все файлы приложения, записи в реестре и так далее, при\r\nпри необходимости - приложение будет автоматически восстановлено). Аналогичным образом можно запустить приложение и для другой\r\nбазы данных, воспользовавшись ярлыком на другой файл `.csmdb23`.\r\n\r\nРекомендую файлы `.csmdb23` размещать на сетевом ресурсе с включенным кешированием, а через GPO+GPP публиковать только ярлыки\r\nна данные файлы.\r\n\r\nВ контекстном меню файла `.csmdb23` присутствуют и другие глаголы: \"Учёт клейм\", \"Метроконтроль - администратор\" (доступен только\r\nв расширенном меню - с Shift). Данные глаголы активируют, как уже понятно, соответствующие приложения.\r\n\r\n### Дополнительные аргументы ярлыков\r\n\r\nПри создании ярлыков на `.csmdb23` файлы следует также указать и дополнительные аргументы. В частности, если после полного пути к\r\nфайлу Вы укажите `csmadmin`, то при двойном щелчке на данном ярлыке будет активировано приложение \"Метроконтроль - администратор\",\r\nесли параметр `markinv` - приложение \"Учёт клейм\", ну а `csmmain` соответствует реакции по умолчанию - запуск приложения \"АИС\r\nМетроконтроль\".\r\n\r\nТаким образом, создав один файл - описатель базы АИС Метроконтроль, мы имеем возможность через GPO+GPP на весь домен назначить \r\nнесколько ярлыков на данный файл, при этом мы можем указать, какое приложение будет активировать ярлык по умолчанию (при двойном\r\nщелчке на ярлыке).\r\n","google":"","note":"Don't delete this file! It's used internally to help with page regeneration."}